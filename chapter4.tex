\chapter{СХЕМА УПРАВЛЕНИЯ ПО ПРОГНОЗИРУЮЩЕЙ МОДЕЛИ}\label{chap4}

Идея настоящей работы основана на подходах традиционно используемых при управлении химическими процессами \cite{Marlin}. В химической промышленности управление процессом должно учитывать целый ряд целей: доходность производства, его эффективность, безопасность, устойчивость и другое. В результате постоянно варьирующихся условий, цели управления часто изменяются, соответственно, должны корректироваться стратегии управления процессом производства.

В силу вышесказанного при управлении химическими процессами принято разделять экономические цели и процесс управления на 2 этапа. На первом этапе, который называется оптимизация в реальном времени выбирается экономическая целевая функция  и формулируется задача оптимизации при ограничениях, задающихся существенными условиями (ценами на рынке, объемами запасов и так далее). Результатом этапа оптимизации в реальном времени является положение равновесия системы (steady-state). На втором этапе применяются методы теории управления, в частности, в последние годы большую популярность преобретают методы управления по прогнозирующей модели (MPC), для стабилизации и слежения за полученными равновесиями траектории. 

В настоящей главе приводятся основные сведения, относящиеся к этапам оптимизация в реальном времени и управление по прогнозирующей модели \cite{Helbig}.

\section{Оптимизация в реальном времени (RTO)}

Рассматривается класс технологических систем, обычно встречающихся в химической промышленности. Из-за сложных механизмов реакции и термодинамических отношений, которые управляют динамикой химических процессов, большинство технологических систем по своей природе
нелинейны. Математически установлено, что класс непрерывных не зависящих от времени нелинейных систем описывается следующим дифференциальным уравнением:

\begin{equation}\label{state_RTO}
	\dot{x}(t)=f(x(t),u(t),w(t))
\end{equation}
где $x \in \mathbb{X}$ --- вектор состояния, $u \in \mathbb{U}$ --- входной вектор, $w \in \mathbb{W}$ --- вектор возмущения.

Помимо нелинейных систем с непрерывным временем были рассмотрены и другие модели для проектирования экономических систем с управлением по прогнозирующей модели. В частности, многие схемы экономических управлений по прогнозирующей модели были разработаны для систем, описываемых нелинейной моделью с дискретным временем, возможно, полученной в результате дискретизации нелинейной модели с непрерывным временем в форме уравнения (\ref{state_RTO}). Система с дискретным временем задается следующим уравнением:

\begin{equation} \label{state_discrete-time_RTO}
	x(k+1)=f_d(x(k),u(k),w(k))
\end{equation}
где $k$ используется для обозначения текущего временного шага, $f_d(\cdot)$ используется, чтобы различать дискретное время нелинейного отображения перехода состояния и нелинейное векторное поле непрерывного времени, обозначаемое $f(\cdot)$. В других случаях рассматриваются линейные системы. 

Прогнозирующие регуляторы, описанные ниже, воспользуются преимуществом (программного) решения модели ($w(t) \equiv 0$) уравнения (\ref{state_RTO}) или (\ref{state_discrete-time_RTO}) для заданной кусочно-постоянной входной траектории $u(t)$. Это состояние траектории или решение начальной задачи уравнения (\ref{state_RTO}) с $w (t) \equiv 0$ для заданного начального условия, и входная траектория определяется как траектория предсказанного состояния без обратной связи, которая обозначается как $x(t)$ и может быть получена путем рекурсивного решения уравнения (\ref{state_RTO}). Если векторное поле $f(\cdot)$ является непрерывно дифференцируемой функцией своих аргументов, существование и единственность этой траектории гарантируется для всех $t \geqslant 0$, при условии, что эта траектория остается в компактном множестве.

Для рассматриваемых процессов непрерывная функция вида $l_e: \mathbb{R}^{n_x} \times \mathbb{R}^{n_u} \to R$ используется в качестве меры мгновенных эксплуатационных затрат (или прибыли) процесса. Поскольку функция $l_e (x, u)$ является прямым или косвенным отражением (мгновенной) экономики процесса, ее обычно называют функцией экономических затрат, функционалом экономических затрат или стоимостью экономической стадии (далее $l_e(\cdot)$ будет упоминается как функция экономических затрат). 

Оптимальное устойчивое состояние определяется как решение следующей задачи оптимизации:

\begin{align}
	l_e(x,u) &\to \min, \label{l_e min}\\
	f(x,u,0)&=0, \label{l_e f}\\
	g(x,u) &\leqslant 0, \label{l_e g}\\
	g_e(x,u) &\leqslant 0, \label{l_e g_e}
\end{align}
где $g: \mathbb{R}^{n_x} \times \mathbb{R}^{n_u} \to \mathbb{R}^{n_p}$ обозначает технологические ограничения, которые могут включать в себя ограничения на управления, а также смешанные ограничения, а $g_e: \mathbb{R}^{n_x} \times \mathbb{R}^{n_u} \to \mathbb{R}^{n_e}$ обозначает экономические ограничения, такие как ограничения для достижения желаемых скоростей производства для удовлетворения потребительского спроса, технические характеристики и качество продукции, а также наличие сырья.

Оптимальное решение уравнения (\ref{l_e min})-(\ref{l_e g_e}) обозначается $x^0, u^0$. Без потери общности, оптимальное стационарное состояние считается единственным, то есть из (\ref{state_RTO}) $f (x^0, u^0, 0) = f (0, 0, 0) = 0)$ и, аналогично, $f_d (x^0, u^0, 0) = f_d (0, 0, 0) = 0$ для системы (\ref{state_discrete-time_RTO}).

Рассмотрим более подробно оптимизацию в реальном времени. Как правило, RTO выполняется с гораздо большим периодам времени и может вычисляться раз в час или даже в день, в отличии от управления по прогнозирующей модели. RTO, как следует из его названия, отвечает за оптимизацию процесса. Эти обязанности могут быть обобщены в четырехшаговом алгоритме:

\begin{enumerate}
	\item RTO систематически анализирует данные процесса, чтобы определить, достигла ли система устойчивого состояния;
	\item когда устойчивое состояние найдено, завершается проверка и согласование данных;
	\item оценка параметров и обновление модели с использованием различных методов;
	\item решается, применять ли новые условия (то есть отправлять вычисленное состояние на уровень, который переводит операцию процесса во вновь вычисленное установившееся состояние).
\end{enumerate}

RTO стала важной информационной системой в промышленности, но оптимизация в реальном времени имеет три основных недостатка. Во-первых, он использует более сложные нелинейные стационарные модели. Во-вторых, оптимизация (или повторная оптимизация) завершается после обнаружения устойчивого состояния процесса. Поскольку процесс по своей природе динамичен и, возможно, находится под воздействием изменяющихся во времени помех, ожидание того, что процесс достигнет устойчивого состояния, может задержать вычисление новых оптимальных условий. Таким образом, повторная оптимизация может проводиться нечасто, что отрицательно влияет на производительность процесса. Одним из решений этой проблемы является частое решение проблемы оптимизации, но это может привести к проблемам устойчивости замкнутой системы. В-третьих, не используется управление типа обратной связи.

Динамическое RTO имеет структуру, аналогичную MPC, в том смысле, что обе проблемы оптимизации, которые характеризуют эти системы, как правило, являются задачами динамической оптимизации, которые работают для минимизации экономической цели в зависимости от модели динамического процесса.
	
\section{Управление по прогнозирующей модели}
Чтобы управлять компромиссом между скоростью отклика замкнутой системы и количеством энергии управления, необходимой для генерации отклика, MPC обычно формулируется с квадратичной целевой функцией, которая штрафует отклонения состояния и входные данные от их соответствующих оптимальных установившихся значений в течение горизонта прогнозирования. Управление по прогнозирующей модели задается следующей задачей динамической оптимизации:

\begin{align}
	\int_0^{\tau_N} (|x(t)|^2_Q &+ |u(t)|^2_R) dt \to \min \label{MPC_J} \\
	\dot{x}(t) &= f(x(t), u(t)) \label{MPC_x} \\
	x(0) &= x_{\tau_k} \label{MPC_x0} \\
	g(x(t), u(t)) &\leqslant 0, \quad \forall t \in [0, \tau_N) \label{MPC_g}
\end{align} 
где положительно определенные матрицы $Q > 0$ и $R > 0$ являются параметрами настройки, которые управляют компромиссом между скоростью отклика и качеством управления; $x(t)$ --- траектория состояния, которая является предсказанной эволюцией состояния. 

Начальные условия динамической модели приведены в формуле (\ref{MPC_x0}), которые полагаются в каждый период времени равными измерениями текущего состояния. Ограничения уравнения (\ref{MPC_g}) --- это ограничения процесса, наложенные на входные данные и состояния, которые обычно являются поточечными ограничениями. (\ref{MPC_g}) обычно записываются как:

\[
	g(x_{\tau_j}, u_{\tau_j}) \leqslant 0, \quad j = 0,1, \dots, N. 
\]

Когда горизонт прогнозирования $N$ конечен, хорошо известно, что схема MPC для задачи (\ref{MPC_J})-(\ref{MPC_g}) может не быть стабилизирующей. При конечных $N$ обеспечить асимптотическую устойчивость можно, если добавить терминальные ограничения и терминальную стоимость в критерий качества.

Чтобы устранить недостатки двухуровневой иерархической структуры управления RTO и MPC, может быть введен промежуточный уровень, называемый целевым (стационарным). Целевой уровень преобразует оптимальное стационарное состояние, вычисленное на уровне RTO, в достижимую точку для уровня управления с обратной связью (MPC). 

В частности, задача квадратичного или линейного программирования используется для преобразования недостижимого желаемого устойчивого состояния в достижимую цель, а затем MPC в задаче (\ref{MPC_J})-(\ref{MPC_g}) приводит замкнутый контур к достижимой цели. Целевая оптимизация или первый этап двухэтапного MPC также позволяет проводить более частую оптимизацию, поскольку она обычно выполняется с той же скоростью, что и MPC.

Ранние исследования по этой теме были сосредоточены на объединении стационарной экономической оптимизации и линейного MPC в одну задачу оптимизации. В частности, схемы MPC, которые интегрируют стационарную оптимизацию, используют функцию стоимости в виде:

\[
	J_{MPC/RTO} (x(t), u(t)) = \int_0^{\tau_N} (|x(t)|^2_Q + |u(t)|^2_R) dt + l_e(x_{\tau_N}, u_s)
\]
которая имеет как квадратичный (отслеживающий) компонент, так и функцию затрат. Эта схема MPC имеет следующую общую формулировку:

\begin{gather}
	J_{MPC/RTO} (x(t), u(t)) \to \min, \label{new_MPC_J} \\ 
	\dot{x}(t) = f(x(t), u(t)), \label{new_MPC_x} \\
	x(0) = x_{\tau_k}, \label{new_MPC_x0} \\
	f(x_{\tau_N}, u_s) = 0, \quad u_s \in U, \label{new_MPC_f} \\
	g(x(t), u(t)) \leqslant 0, \quad \forall t \in [0, \tau_N), \label{new_MPC_g}
\end{gather}
где переменные задачи оптимизации включают в себя как входную траекторию по прогнозирующему горизонту, так и установившийся входной сигнал. Ограничение уравнения (\ref{new_MPC_f}) обеспечивает, что траектория предсказанного состояния $x(t)$ сходится к допустимому промежуточному состоянию. Остальные ограничения и обозначения аналогичны задаче (\ref{MPC_J})-(\ref{MPC_g}).

%\section{Управление по прогнозирующей модели}

%Основным достоинством управления по прогнозирующей модели является относительная простота формирования обратной связи. Это  позволяет управлять многосвязными и многомерными объектами со сложной структурой, таких как нелинейности, оптимизация процессов в режиме реального времени в рамках ограничений на управляемые и управляющие переменные,а так же учитывать неопределенности в задании объектов и возмущений. Кроме того, возможно учитывать транспортное запаздывание, изменение критериев качества в ходе процесса и отказов датчиков системы измерения.

Подход MPC составляет следующая схема управления динамическими объектами типа обратной связи:

\begin{enumerate}
	\item Рассматривается некоторая математическая модель. Начальными условиями служит его текущее состояние. При заданном  управлении выполняется интегрирование уравнений математической модели, что дает прогноз движения объекта на некотором конечном отрезке времени.
	\item Выполняется оптимизация управления. Цель --- приближение регулируемых переменных прогнозирующей модели к соответствующим задающим сигналам на отрезке времени. Оптимизация осуществляется с учётом всех ограничений, наложенных на регулируемые и управляющие переменные.
	\item На фиксированном небольшом отрезке времени, реализуется найденное оптимальное управление и осуществляется восстановление по измеренным переменным фактического состояния объекта на конечном шаге.
	\item Отрезок времени (или горизонт прогноза) сдвигается на шаг вперед, и повторяются пункты 1-3. 
\end{enumerate}

Заметим, что в силу отличия динамики реального объекта и прогнозирующей модели их движения на рассмотренном отрезке будут отличаться, а совпадение гарантируется только в начальной точке.

Если положить $\tau_N \to \infty$ и осуществлять прогноз от точки $t = 0$ на бесконечном интервале времени $t \in [0, \infty)$, можно найти управление и реализовать его в виде $u(t) = u^*(t)$
для модели (\ref{MPC_J})-(\ref{MPC_g}). Считаем, что целью управления является выполнение равенств:
\[
	\lim_{t \to \infty} \| x(t) - r_x(t) \| = 0, \quad \lim_{t \to \infty} \|u(t) - r_u(t) \| = 0,
\]
где $r_x(t)$ и $r_u(t)$ --- векторные функции, которые заданы и  определяют желаемое движение объекта. Такое управление будет решением задачи оптимизации для реального объекта по отношению к функционалу

\begin{equation}
	J_0 (x(t),u(t)) = \int_0^{\infty} F(x(t, x(0), u(t)), u(t), r_x(t), r_u(t)) dt.
\end{equation}

Нахождение управления на базе однократного прогноза приводит к значительным отклонениям от оптимального. Для улучшения ситуации, выполняется многократный прогноз с периодам $\delta$. Однако такой подход обладает как минимум двумя недостатками. Во-первых, на каждом отрезке управление осуществляется по разомкнутой схеме, то есть, без обратной связи, что в ряде случаев недопустимо. Во-вторых, ввиду отличия реальной динамики от прогнозируемой, движение под воздействием принятого управления может существенно отличаться от оптимального.

Принято говорить, что такой способ оптимизации управления по прогнозирующей модели использует прогноз с подвижным горизонтом.

Общая схема управления с предсказанием описывается следующим образом:

\begin{enumerate}
	\item Оценивание  или измерение вектора состояния  реального объекта.
	\item Решение задачи (\ref{MPC_J})-(\ref{MPC_g}).
	\item Использование найденной оптимальной функции $u^*$ в качестве программного управления на отрезке $\tau \in [t, t+\delta]$.
	\item Замена момента времени $t$ на момент $t+\delta$ и повторение операций в пунктах 1-3.
\end{enumerate}

Приведенная схема реализуется в системе управления с обратной связью.

Подводя итог можно выделить некоторые особенности схемы управления по прогнозирующей модели:

\begin{enumerate}
	\item Можно использовать нелинейные системы обыкновенных дифференциальных уравнений в качестве прогнозирующей модели.
	\item Управление по прогнозирующей модели позволяет учитывать ограничения, которые наложены на управляющие переменные, и на вектора состояния.
	\item Подход предусматривает минимизацию функционала, который характеризует качество управления, в режиме реального времени.
	\item Предсказанное поведение динамического объекта, отличается от его реального движения.
	\item Управлению по прогнозирующей модели необходимо, чтобы текущее состояние объекта измерялось или оценивалось.
\end{enumerate}
\bigskip
%Каждая глава завершается краткими выводами. Разумный способ написания выводов --- переписать (это значит использовать те же мысли, но не копировать фразы!) в утвердительной форме (рассмотрено, получено и т.д.) то, что написано во врезке. 