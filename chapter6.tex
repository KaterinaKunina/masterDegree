\chapter{ЧИСЛЕННЫЕ ЭКСПЕРИМЕНТЫ}\label{chap6}

В настоящей главе для двух экономических задач главы \ref{chap5} проводятся численные эксперименты: методы управления с прогнозирующей моделью применяются для отслеживания магистралей этих задач при различных значениях параметров. Сравниваются управления и траектории замкнутых систем при различном выборе горизонта управления прогнозирующих задач, а также исследуется влияние весового коэффициента в критерии качества, штрафующего большие отклонения состояний по сравнению с отклонениями управлений от устойчивого положения (магистрали).

\section{Неоклассическая модель роста: результаты}

Для моделей, обладающих магистральным свойством, на интервале времени движения имеются два момента изменения характера движения: выход на магистраль и сход с магистрали.

Рассмотрим неоклассическую модель оптимального экономического роста из главы \ref{chap5}:
\begin{align}
	J(x,u) = &\int_0^\infty e^{-\rho t} [\ln(1- u(t)) + \ln f(x(t))] dt \to \max, \label{ex1_4s} \\
	\dot{x}(t) &= u(t) f(x(t)) - \mu x(t), \\
	 &0 \leqslant u(t) \leqslant 1-\varepsilon, \\
	&\quad x(0) = x_0. \label{ex1_4s_end}
\end{align}

Магистрали (траектории сбалансированного роста) соответствуют значениям $x^*, u^*$. Им соответствует единственная так называемая траектория сбалансированного роста (стационарный режим). Для нахождения стационарного состояния используем формулы (\ref{Ex1_steady_state}). 

Параметрам задачи присвоим значения: 
$$f(x) = x^{\alpha},\; t_f = 2,\; x_0 = 1,\; \mu = 0.05,\; \rho = 0.02,\; \alpha = 0.4.$$ 

Стационарное состояние в Matlab получим следующим образом:
\begin{verbatim}
x_s = fsolve(@(x) alpha*x^(alpha-1) - (mu+rho), 12, optoff);
u_s = mu*x_s/(x_s^alpha);
\end{verbatim}

Для выбранных значений параметров получаем следующее решение:
$$x^* = 18.2643,\; u^* = 0.2857.$$

Схема управления по прогнозирующей модели формулируется с помощью следующей прогнозирующей задачи:
\begin{align}
	J(x,u) = &\int_0^{\tau_N} w|x(t) - x^*|_2^2 + |u(t) - u^*|_2^2 dt \to \min, \label{Ex1_impotant0} \\
	\dot{x}(t) &= u(t) f(x(t)) - \mu x(t), \quad x(0) = x_{\tau_p}, \label{Ex1_impotant1}\\
	u_s f&(x_{\tau_N}) - \mu x_{\tau_N} = 0, \label{Ex1_impotant2}\\
	 &0 \leqslant u(t) \leqslant 1-\varepsilon, \quad t \in [0, \tau_N). \label{Ex1_impotant3}\\	
\end{align}
где $w$ --- весовой коэффициент. Ограничение уравнения (\ref{Ex1_impotant2}) обеспечивает, что траектория предсказанного состояния $x(t)$ сходится к допустимому промежуточному состоянию. Остальные ограничения и обозначения аналогичны задаче (\ref{ex1_4s})-(\ref{ex1_4s_end}).

Реализация метода MPC в Matlab с использованием CasADi и встроенного в нем класса Opti:
\begin{verbatim}
opti.minimize(obj);

% Начальные приближения для солвера
opti.set_initial(X, 1);
opti.set_initial(U, umin);

opti.solver('ipopt');
opti.set_value(xtau, x0);

for tau = 0:Nmpc
    tic
    % Решаем задачу нелинейного программирования
           sol = opti.solve();  
    t_Elapsed = toc;
      
    % Восстанавливаем значения переменных
    u_opt = opti.value(U);
    x_opt = opti.value(X);
    J_opt = opti.value(obj);
    % Переходим к следующему состоянию
    opti.set_value(xtau, x_opt(1:n,2));    
end
\end{verbatim}

Переменные и параметры модели задаются следующим образом:
\begin{verbatim}
Nmpc = 75;
X    = opti.variable(2,N+1);
U    = opti.variable(1,N);
xtau = opti.parameter(1);
obj = X(2,end);
\end{verbatim}

Перед реализацией метода MPC, необходимо учитывать ограничения (\ref{Ex1_impotant1})-(\ref{Ex1_impotant3}). В Matlab это записывается так:
\begin{verbatim}
% Собираем ограничения для динамики системы
opti.subject_to(X(1:n,1) == xtau);
opti.subject_to(X(n+1,1) == 0);

% Собираем "динамические" ограничения 
for k=1:N
    x_next = RK4((k-1)*h,X(:,k),U(k));
    opti.subject_to(X(:,k+1) == x_next);
end

% Собираем ограничения на управление
opti.subject_to( umin <= U(:) <= umax); 
\end{verbatim}

Так как применяемый метод MPC разработан для моделей с дискретным временем, то для решения задачи (\ref{Ex1_impotant0})-(\ref{Ex1_impotant3}) необходимо произвести дискретизацию. В данном случае использовался метод Рунге-Кутты 4-го порядка \cite{differential}.

Везде на рисунках штриховые линии --- погнозируемые управления и траектории из прогнозирующей задачи (\ref{ex1_4s})-(\ref{ex1_4s_end}), сплошные --- реализации обратной связи и соответствующей траектории системе, замкнутой МРС-регулятором. Построенные с помощью схемы МРС реализации обратной связи (оптимальное управление) и соответствующие траектории при различных значениях параметров представлены на рис. \ref{fig_x1_tf2_w1}-\ref{fig_x1_tf2_w10}. 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_x1_tf2_w1.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 2,\, x_0 = 1, \, w = 1, \, \mu = 0.05,\, \rho = 0.02,\, \alpha = 0.4$}
\label{fig_x1_tf2_w1}
\end{figure} 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_x20_tf2_w1.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 2,\, x_0 = 10, \, w = 1, \, \mu = 0.05,\, \rho = 0.02,\, \alpha = 0.4$}
\label{fig_x20_tf2_w1}
\end{figure} 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_x1_tf50_w1.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 50,\, x_0 = 1, \, w = 1, \, \mu = 0.05,\, \rho = 0.02,\, \alpha = 0.4$}
\label{fig_x1_tf50_w1}
\end{figure} 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_x1_tf2_w01.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 2,\, x_0 = 1, \, w = 0.1, \, \mu = 0.05,\, \rho = 0.02,\, \alpha = 0.4$}
\label{fig_x1_tf2_w01}
\end{figure} 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_x1_tf2_w10.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 2,\, x_0 = 1, \, w = 10, \, \mu = 0.05,\, \rho = 0.02,\, \alpha = 0.4$}
\label{fig_x1_tf2_w10}
\end{figure} 


Как видно из рисунков, все траектории достигают магистралей, однако происходит это в разные моменты времени. Можно также сделать следующие выводы:

Построение магистралей показано на рис. \ref{fig_x1_tf2_w1}-\ref{fig_x1_tf2_w10}. По графикам можно сделать вывод: 
\begin{enumerate}
\item Изменение начального состояния $x_0$ (см. рис. \ref{fig_x1_tf2_w1} и рис. \ref{fig_x20_tf2_w1}) 
	\begin{enumerate}
	\item $x_0 < x^*$: фирма инвестирует в основные производственные фонды, таким образом величина капитала на единицу рабочей силы уменьшается. Это происходит до тех пор, пока качество потребления и инвестиций не примут наибольшее значение.
	\item $x_0 > x^*$: объем производства потребляется до тех пор, пока траектории не выйдут на магитраль. В этом случае объем производства соответствует потреблению.
	\end{enumerate}
\item Изменение длины горизонта $t_f$ (см. рис. \ref{fig_x1_tf2_w1} и рис. \ref{fig_x1_tf50_w1}). Чем больше длина горизонта, тем быстрее траектории выходят на магистраль, то есть сложнее анализировать развитие экономики.
\item Изменение весового коэффициента $w$ (см. рис. \ref{fig_x1_tf2_w1}, рис. \ref{fig_x1_tf2_w01} и рис. \ref{fig_x1_tf2_w10}). На рис. \ref{fig_x1_tf2_w01} изображено поведение замкнутой системы при w = 0.1, на рис. \ref{fig_x1_tf2_w1} --- при w = 1, на рис. \ref{fig_x1_tf2_w10} --- при w = 10. Заметим, что решение, изображенное на рис. \ref{fig_x1_tf2_w10}, сильнее штрафует отклонения состояния от магистрали, чем отклонения управления от магистрального значения. Это решение хорошо приближает оптимальное решение исходной задачи с бесконечным горизонтом \cite{Kryazhimski}.
\end{enumerate}


%\newcounter{figcount}[chapter]
%\renewcommand{\thefigcount}{\arabic{chapter}.\arabic{figcount}}
%\newcommand{\dfig}[1]%
%{\refstepcounter{figcount}\rm Рисунок \thefigcount \ --- \  #1}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Модель открытой экономики: результаты}

Аналогичным образом строятся магистрали и для задачи оптимизации открытой экономики.

Рассмотрим неоклассическую модель оптимального экономического роста из главы \ref{chap5}:
\begin{align} \label{Ex2}
	 J(c,i) = e^{-\rho t_f} &a(t_f) + \int_0^{t_f} e^{-\rho t}c(t) dt \to \max, \\
	 \dot{a}=(r-n)a &+ f(k)-(\delta +r)k-c, a(0)=a_0, \\
	 \dot{k} = &-(\delta + n)k + i, k(0)=k_0, \\
	 &c(t) \geqslant 0, i(t) \geqslant 0, \\
	 0 \leqslant a(&t) \leqslant k(t) \leqslant a(t) + b^*, t \in [0, t_f]. \label{Ex2_end}
\end{align}

Магистрали (траектории сбалансированного роста) соответствуют значениям $a^* = k^*, c_*, i_*$. Им соответствует траектория сбалансированного роста (стационарный режим). 

Параметрам задачи присвоим значения:
$$f(k) = k^{\alpha}, \; t_f = 2,\; a_0 = 1,\; k_0 = 5,\; b^* = 4,\; \delta = 0.05,\; \rho = 0.02,\; \alpha = 0.4,$$ 
$$r = 0.08,\; n = 0.03. $$ 

Стационарное состояние в Matlab вычисляется исходя полученным формулам в главе \ref{chap5} (\ref{Ex2_steady_state}).
\begin{verbatim}
		f = @(k) k^alpha;
        df = @(k) alpha*k^(alpha-1);
        
        k_s = fsolve(@(k) df(k)-(delta+rho+n),1,optoff); %k_s = a_s
        i_s  = (delta + n) *k_s;
        c_s  = k_s^(alpha) - (delta + n)*k_s;
\end{verbatim}

Получаем следующее решение: 
$$a^* = k^* = 10.0792,\; c_* = 1.7135,\; i_* = 0.8063.$$

Схема управления по прогнозирующей модели формулируется с помощью следующей прогнозирующей задачи:
\begin{align}  \label{Ex2_MPC}
J(c,i) = &\int_0^{\tau_N} w(|a - a^*|_2^2 + |k - k^*|_2^2 + |c - c_*|_2^2 + |i - i_*|_2^2) dt \to \min, \\
&\dot{a} = (r-n)a + f(k)-(\delta +r)k-c, \quad a(0)=a_{\tau_p}, \\
	 &\dot{k} = -(\delta + n)k + i, \quad k(0)=k_{\tau_p}, \\
	 &(r-n)a_{\tau_N} + f(k_{\tau_N})-(\delta +r)k_{\tau_N}-c_s = 0, \label{Ex2_MPC_1}\\
	 &-(\delta + n)k_{\tau_N} + i_s = 0, \label{Ex2_MPC_2}\\
	 &c(t) \geqslant 0, i(t) \geqslant 0, \\
	 &0 \leqslant a(t) \leqslant k(t) \leqslant a(t) + b^*, t \in [0, \tau_N). \label{Ex2_MPC_end}
\end{align}
где $w$ --- весовой коэффициент. Ограничения уравнений (\ref{Ex2_MPC_1}), (\ref{Ex2_MPC_2}) обеспечивают, что траектории $a(t), k(t)$ сходится к допустимому промежуточному состоянию. Остальные ограничения и обозначения аналогичны задаче (\ref{Ex2})-(\ref{Ex2_end}).

Реализация метод MPC в Matlab:
\begin{verbatim}
opti.minimize(obj);

% Начальные приближения для солвера
opti.set_initial(X, 1);
opti.set_initial(U, umin);

opti.solver('ipopt');
opti.set_value(xtau, x0);

for tau = 0:Nmpc
    tic
    % Решаем задачу нелинейного программирования 
        sol = opti.solve();  
    t_Elapsed = toc;
      
    % Восстанавливаем значения переменных
    u_opt = opti.value(U);
    x_opt = opti.value(X);
    J_opt = opti.value(obj);
    % Переходим к следующему состоянию
    opti.set_value(xtau, x_opt(1:n,2));    
end
\end{verbatim}

Переменные и параметры модели задаются следующим образом:
\begin{verbatim}
Nmpc = 75;
X    = opti.variable(3,N+1);
U    = opti.variable(2,N);
xtau = opti.parameter(2);
obj = X(3,end);
\end{verbatim}

Перед реализацией метода MPC, необходимо учитывать ограничения (\ref{Ex2_MPC_1})-(\ref{Ex2_MPC_2}). В Matlab это записывается так:
\begin{verbatim}
% Собираем ограничения для динамики системы
opti.subject_to(X(1:n,1) == xtau);
opti.subject_to(X(n+1,1) == 0);

% Собираем "динамические" ограничения 
for k=1:N
    x_next = RK4((k-1)*h,X(:,k),U(:,k));
    opti.subject_to(X(:,k+1) == x_next);
end

% Собираем ограничения на состояния
for k=2:N+1
    opti.subject_to( 0 <= X(1,k));
    opti.subject_to( X(1,k) <= X(2,k) <= X(1,k) + b);
end

% Собираем ограничения на управление
opti.subject_to( umin <= U(:)); 
\end{verbatim}

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_ex2_x1_1_tf2_w1.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 2,\, a = 1, k = 5, \, w = 1, \, \delta = 0.05, \rho = 0.02, \alpha = 0.4, r = 0.08, n = 0.03$}
\label{fig_ex2_x1_1_tf2_w1}
\end{figure} 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_ex2_x20_20_tf2_w1.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 2,\, a = 20, k = 25, \, w = 1, \, \delta = 0.05, \rho = 0.02, \alpha = 0.4, r = 0.08, n = 0.03$}
\label{fig_ex2_x20_20_tf2_w1}
\end{figure} 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_ex2_x1_1_tf10_w1.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 10,\, a = 1, k = 5, \, w = 1, \, \delta = 0.05, \rho = 0.02, \alpha = 0.4, r = 0.08, n = 0.03$}
\label{fig_ex2_x1_1_tf10_w1}
\end{figure} 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_ex2_x1_1_tf2_w03.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 2,\, a = 1, k = 5, \, w = 0.3, \, \delta = 0.05, \rho = 0.02, \alpha = 0.4, r = 0.08, n = 0.03$}
\label{fig_ex2_x1_1_tf2_w03}
\end{figure} 

\begin{figure}[h!]
\noindent\centering{
\includegraphics[width=0.91\textwidth]{fig_ex2_x1_1_tf2_w10.eps}
}
\caption{Отслеживание магистралей при параметрах задачи: 
$t_f = 2,\, a = 1, k = 5, \, w = 10, \, \delta = 0.05, \rho = 0.02, \alpha = 0.4, r = 0.08, n = 0.03$}
\label{fig_ex2_x1_1_tf2_w10}
\end{figure} 

Везде на рисунках штриховые линии --- это прогнозируемые управления ($c$ --- синяя линия, $i$ --- красная линия) из прогнозирующей задачи (\ref{Ex2_MPC})-(\ref{Ex2_MPC_end}). Сплошные --- реализация обратной связи ($a$ --- синяя линия, $k$ --- красная линия).

Построенные с помощью схемы МРС реализации обратной связи (оптимальное управление) и соответствующие траектории при различных значениях параметров представлены на рис. \ref{fig_ex2_x1_1_tf2_w1}-\ref{fig_ex2_x1_1_tf2_w10}. 

Как видно из рисунков, все траектории достигают магистралей, однако происходит это в разные моменты времени. Можно также сделать следующие выводы:
 
\begin{enumerate}
\item Изменение начального состояния (см. рис. \ref{fig_ex2_x1_1_tf2_w1} и рис. \ref{fig_ex2_x20_20_tf2_w1}) 
	\begin{enumerate}
	\item $a_0 < a^*, k_0 < k^*$: 
активы, собственный капитал увеличиваются, фирма ивестирует в производственные фонды, но потребление находится в равновесии. Спустя некоторое время фирма уменьшает количество вкладываемых денег в ивестирование, а именно начинает выплачивать кредит. Потребление начинает увеличиваться и вскоре траектории выходят на магистраль,то есть экономика начинает развиваться только за счет средств собственного капитала, а заемные средства полностью выплачены.
	\item $a_0 > a^*, k_0 > k^*$:
активы фирмы падают, следовательно падает потребление. В это время инвестирование стабильное (в сявязи с использованием кредита). Когда потребление выходит на магистраль, фирма начинает вкладывать инвестиции в производство до тех пор, пока качество потребления и инвестиций не примут наибольшее значение. 
	\end{enumerate}
\item Изменение длины горизонта $t_f$ (см. рис. \ref{fig_ex2_x1_1_tf2_w1} и рис. \ref{fig_ex2_x1_1_tf10_w1}).
Видно, что выбор малых значений $t_f$ гаризонта прогноза не обеспечивает хорошие качественные показатели. Исходя из требований к качеству, имеет смысл принять $t_f = 2$, поскольку дальнейшее увеличение горизонта прогноза не влечет никаких изменений на траектории управления.
\item Изменение весового коэффициента $w$ (см. рис. \ref{fig_ex2_x1_1_tf2_w1}, рис. \ref{fig_ex2_x1_1_tf2_w03} и рис. \ref{fig_ex2_x1_1_tf2_w10}). Заметим, что решение, изображенное на рис. \ref{fig_ex2_x1_1_tf2_w10}, сильнее штрафует отклонения состояния от магистрали, чем отклонения управления от магистрального значения.
\end{enumerate}

























\bigskip

%Каждая глава завершается краткими выводами. Разумный способ написания выводов --- переписать (это значит использовать те же мысли, но не копировать фразы!) в утвердительной форме (рассмотрено, получено и т.д.) то, что написано во врезке. 